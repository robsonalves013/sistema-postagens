{% extends "base.html" %}

{% block title %}Dashboard - Sistema de Postagens Foguete Express üöÄ{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <h1><i class="bi bi-speedometer2"></i> Dashboard - {{ data_hoje }}</h1>
        <p class="text-muted">Controle di√°rio dos dois postos de postagem</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12 col-sm-6 col-md-3 mb-2">
        <a href="{{ url_for('nova_postagem') }}" class="btn btn-primary btn-lg w-100">
            <i class="bi bi-plus-circle"></i> Nova Postagem
        </a>
    </div>
    <div class="col-12 col-sm-6 col-md-3 mb-2">
        <a href="{{ url_for('fechamento') }}" class="btn btn-success btn-lg w-100">
            <i class="bi bi-clipboard-check"></i> Fechamento do Dia
        </a>
    </div>
    <div class="col-12 col-sm-6 col-md-3 mb-2">
        <a href="{{ url_for('relatorio_mensal') }}" class="btn btn-info btn-lg w-100">
            <i class="bi bi-bar-chart"></i> Gerar Relat√≥rio Mensal
        </a>
    </div>
    <div class="col-12 col-sm-6 col-md-3 mb-2">
        <button class="btn btn-warning btn-lg w-100" onclick="window.print()">
            <i class="bi bi-printer"></i> Imprimir Relat√≥rio
        </button>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card stats-card posto-1 mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-building"></i> Shopping Bol√≠via</h5>
                <div class="row mb-3">
                    <div class="col-6">
                        <h3>{{ resumo_posto1.total_postagens }}</h3>
                        <small>Total de Postagens</small>
                    </div>
                    <div class="col-6">
                        <h3>R$ {{ "%.2f"|format(resumo_posto1.total_valor) }}</h3>
                        <small>Valor Total</small>
                    </div>
                </div>
                <hr style="border-color: rgba(255,255,255,0.3);">
                <div class="row text-sm">
                    <div class="col-3">
                        <strong>{{ resumo_posto1.total_pac }}</strong><br>
                        <small>PAC</small>
                    </div>
                    <div class="col-3">
                        <strong>{{ resumo_posto1.total_sedex }}</strong><br>
                        <small>SEDEX</small>
                    </div>
                    <div class="col-3">
                        <strong>R$ {{ "%.2f"|format(resumo_posto1.total_pix) }}</strong><br>
                        <small>PIX</small>
                    </div>
                    <div class="col-3">
                        <strong>R$ {{ "%.2f"|format(resumo_posto1.total_dinheiro) }}</strong><br>
                        <small>Dinheiro</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card stats-card posto-2 mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-building"></i> Hotel Family</h5>
                <div class="row mb-3">
                    <div class="col-6">
                        <h3>{{ resumo_posto2.total_postagens }}</h3>
                        <small>Total de Postagens</small>
                    </div>
                    <div class="col-6">
                        <h3>R$ {{ "%.2f"|format(resumo_posto2.total_valor) }}</h3>
                        <small>Valor Total</small>
                    </div>
                </div>
                <hr style="border-color: rgba(255,255,255,0.3);">
                <div class="row text-sm">
                    <div class="col-3">
                        <strong>{{ resumo_posto2.total_pac }}</strong><br>
                        <small>PAC</small>
                    </div>
                    <div class="col-3">
                        <strong>{{ resumo_posto2.total_sedex }}</strong><br>
                        <small>SEDEX</small>
                    </div>
                    <div class="col-3">
                        <strong>R$ {{ "%.2f"|format(resumo_posto2.total_pix) }}</strong><br>
                        <small>PIX</small>
                    </div>
                    <div class="col-3">
                        <strong>R$ {{ "%.2f"|format(resumo_posto2.total_dinheiro) }}</strong><br>
                        <small>Dinheiro</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Lista de Postagens do Dia -->
<div class="card mb-4">
    <div class="card-header">
        <h5><i class="bi bi-list-ul"></i> Postagens de Hoje</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <!-- Posto 1 -->
            <h6>Shopping Bol√≠via</h6>
            <table class="table table-striped table-hover" id="tabela-posto1">
                <thead class="table-dark">
                    <tr>
                        <th>Remetente</th><th>Tipo</th><th>Valor</th><th>Pagamento</th><th>Data Pagamento</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in postagens %}
                        {% if p[2]==1 %}
                        <tr>
                            <td>{{ p[3] }}</td>
                            <td>{{ p[6] }}</td>
                            <td>R$ {{ "%.2f"|format(p[5]) }}</td>
                            <td>{{ p[7] or 'Pendente' }}</td>
                            <td>{% if p[10] %}{{ p[10]|datetimeformat }}{% else %}Pendente{% endif %}</td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
            <!-- Posto 2 -->
            <h6>Hotel Family</h6>
            <table class="table table-striped table-hover" id="tabela-posto2">
                <thead class="table-dark">
                    <tr>
                        <th>Remetente</th><th>Tipo</th><th>Valor</th><th>Pagamento</th><th>Data Pagamento</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in postagens %}
                        {% if p[2]==2 %}
                        <tr>
                            <td>{{ p[3] }}</td>
                            <td>{{ p[6] }}</td>
                            <td>R$ {{ "%.2f"|format(p[5]) }}</td>
                            <td>{{ p[7] or 'Pendente' }}</td>
                            <td>{% if p[10] %}{{ p[10]|datetimeformat }}{% else %}Pendente{% endif %}</td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function atualizar(posto) {
    const res = await fetch(`/api/postagens/${posto}`);
    const data = await res.json();
    const tbody = document.querySelector(`#tabela-posto${posto} tbody`);
    tbody.innerHTML = data.postagens.map(p => `
        <tr>
            <td>${p.nome_remetente}</td>
            <td>${p.tipo_postagem}</td>
            <td>R$ ${p.valor.toFixed(2)}</td>
            <td>${p.tipo_pagamento}</td>
            <td>${p.data_postagem}</td>
        </tr>
    `).join('');
}
setInterval(() => { atualizar(1); atualizar(2); }, 10000);
</script>
{% endblock %}
